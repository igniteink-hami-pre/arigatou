<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ご来場ありがとうございます｜展示のお礼</title>

<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg: #FBF6F2;
    --panel: #FFFFFF;
    --accent: #C7634F;
    --text: #222222;
    --muted: #6F665F;
    --radius: 14px;
    --max-width: 720px;
  }
  html,body{height:100%;margin:0;}
  body{
    font-family:"Noto Sans JP","Yu Gothic","Hiragino Kaku Gothic ProN",Meiryo,sans-serif;
    background:linear-gradient(180deg,var(--bg), #fff);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:20px;
    box-sizing:border-box;
  }

  .card{
    width:100%;
    max-width:var(--max-width);
    background:var(--panel);
    border-radius:var(--radius);
    padding:18px;
    box-shadow:0 10px 30px rgba(30,20,10,0.06);
    box-sizing:border-box;
  }

  header{display:flex;gap:12px;align-items:flex-start}
  .logo{
    width:54px;height:54px;border-radius:10px;
    background:linear-gradient(135deg,#FFF7F2,#FFF);
    display:flex;align-items:center;justify-content:center;
    border:1px solid rgba(0,0,0,0.04);flex:0 0 54px;
  }
  .logo svg{width:30px;height:30px;fill:var(--accent)}
  h1{margin:0;font-size:18px;color:var(--accent);line-height:1.15;font-weight:700}
  p.lead{margin:8px 0 12px 0;font-size:14px;color:var(--text)}

  .info{
    font-size:13px;color:var(--muted);line-height:1.5;margin-bottom:14px;
  }

  /* Always vertical stack buttons */
  .actions{
    display:flex;
    flex-direction:column;
    gap:12px;
    margin-top:6px;
  }
  .btn{
    display:block;padding:14px;border-radius:12px;text-align:center;
    font-weight:700;font-size:15px;text-decoration:none;color:#fff;background:var(--accent);
    box-shadow:0 8px 20px rgba(197,99,79,0.12);border:0;
  }
  .btn.secondary{
    background:transparent;color:var(--accent);border:1px solid rgba(197,101,79,0.14);
    box-shadow:none;font-weight:700;
  }

  .thank{margin-top:14px;font-size:13px;color:var(--muted);text-align:center}

  footer{margin-top:16px;text-align:center;color:var(--muted);font-size:12px}

  /* --- password overlay styles --- */
  .pw-overlay{
    position:fixed;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    background:linear-gradient(180deg, rgba(0,0,0,0.45), rgba(0,0,0,0.55));
    z-index:9999;
    padding:24px;
    box-sizing:border-box;
  }
  .pw-box{
    width:100%;
    max-width:420px;
    background:#fff;
    border-radius:14px;
    padding:18px;
    box-sizing:border-box;
    box-shadow:0 20px 40px rgba(0,0,0,0.25);
    text-align:center;
  }
  .pw-box h2{margin:0 0 10px 0;font-size:18px;color:var(--accent)}
  .pw-desc{font-size:13px;color:var(--muted);margin-bottom:14px}
  .pw-input{
    width:100%;padding:12px 14px;border-radius:10px;border:1px solid #e6e2df;
    font-size:16px;box-sizing:border-box;margin-bottom:12px;
  }
  .pw-actions{display:flex;gap:8px;justify-content:center}
  .pw-btn{flex:1;padding:12px;border-radius:10px;border:0;font-weight:700}
  .pw-btn.primary{background:var(--accent);color:#fff}
  .pw-btn.secondary{background:#f3f0ee;color:var(--accent);border:1px solid rgba(197,101,79,0.08)}
  .pw-error{color:#b00020;font-size:13px;margin-top:8px;min-height:18px}
  /* prevent focus on background while locked */
  body.locked *:not(.pw-overlay):not(.pw-overlay *){pointer-events:none;user-select:none}
</style>
</head>
<body class="locked">
  <!-- Password overlay (表示：ページ読み込み時に先に出す) -->
  <div id="pwOverlay" class="pw-overlay" role="dialog" aria-modal="true" aria-labelledby="pwTitle">
    <div class="pw-box" role="document">
      <h2 id="pwTitle">パスワードを入力してください</h2>
      <div class="pw-desc">本画面を表示するにはパスワードが必要です。</div>
      <input id="pwInput" class="pw-input" type="password" inputmode="text" autocomplete="off" placeholder="パスワード" aria-label="パスワード入力">
      <div class="pw-actions">
        <button id="pwSubmit" class="pw-btn primary">開く</button>
        <button id="pwClear" class="pw-btn secondary" type="button">クリア</button>
      </div>
      <div id="pwError" class="pw-error" aria-live="polite"></div>
    </div>
  </div>

  <!-- 元ページのメイン（ロック解除まで操作不可） -->
  <main id="mainContent" class="card" role="main" aria-labelledby="title" aria-hidden="true">
    <header>
      <div class="logo" aria-hidden="true">
        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 2L3 7v9c0 1.1.9 2 2 2h3v-6h6v6h3c1.1 0 2-.9 2-2V7l-9-5z"/></svg>
      </div>
      <div>
        <h1 id="title">ご来場ありがとうございます</h1>
        <p class="lead">本日はお越しいただき、心より感謝申し上げます。下のボタンから展示の画像データをダウンロード／アンケートにお進みください。</p>
      </div>
    </header>

    <div class="info" role="note">
      <strong>使い方</strong><br>
      ①「作品画像データ」をタップすると、展示作品の画像フォルダが開きます。<br>
      ②「アンケートに回答する」は所要1〜2分です。ご感想をお聞かせください。
    </div>

    <section class="actions" aria-label="主要アクション">
      <!-- ここを実際のリンクに置き換えてください -->
      <a id="drive-link" class="btn" href="https://drive.google.com/drive/folders/1F55MdxEi_-LPK6TXrhbeHH8F56azBPz4?usp=sharing" target="_blank" rel="noopener noreferrer">▶ 作品画像データをダウンロード</a>
      <a id="form-link" class="btn secondary" href="https://forms.gle/ZL8J9ABdgxBJLFd18" target="_blank" rel="noopener noreferrer">▶ アンケートに回答する（所要1〜2分）</a>
    </section>

    <p class="thank">作品をお楽しみいただけたなら、ぜひご感想をお聞かせください。いただいたご意見は今後の展示に活かします。</p>

    <footer>— 本展（ご来場に心より感謝いたします）</footer>
  </main>

<script>
/*
  PBKDF2 照合（クライアント側に埋め込んだ salt と 派生キーを使います）
  - パスワードを直接ファイルに置かず、派生した値で照合することで
    平文を直接書くより分かりづらくします（ただしソースを見られると salt と派生キーは見えます）。
  - もし本当に高い安全性が必要なら、サーバー側で認証してください。
*/

(async () => {
  // --- 埋め込まれた値（ここを差し替えました） ---
  const STORED = {
    saltBase64: "17BCHGOIa/zziJ+99BcRkQ==",
    iterations: 150000,
    derivedKeyBase64: "KhKERIOv8+PcuDzSx2ynWt3iyHDBjQaadCKX1XawFyk="
  };
  // -----------------------------------------------

  const utf8 = (s) => new TextEncoder().encode(s);
  const toBase64 = (u8) => {
    let s = "";
    for (let i = 0; i < u8.length; i++) s += String.fromCharCode(u8[i]);
    return btoa(s);
  };
  const fromBase64ToUint8 = (b64) => {
    const s = atob(b64);
    const u8 = new Uint8Array(s.length);
    for (let i = 0; i < s.length; i++) u8[i] = s.charCodeAt(i);
    return u8;
  };
  const constTimeEqual = (a, b) => {
    if (a.length !== b.length) return false;
    let diff = 0;
    for (let i = 0; i < a.length; i++) diff |= (a[i] ^ b[i]);
    return diff === 0;
  };

  async function deriveKeyPBKDF2(password, saltBase64, iterations) {
    const salt = fromBase64ToUint8(saltBase64);
    const keyMaterial = await crypto.subtle.importKey(
      "raw", utf8(password), { name: "PBKDF2" }, false, ["deriveBits"]
    );
    const derivedBits = await crypto.subtle.deriveBits(
      {
        name: "PBKDF2",
        salt: salt,
        iterations: iterations,
        hash: "SHA-256"
      },
      keyMaterial,
      256
    );
    return new Uint8Array(derivedBits);
  }

  const overlay = document.getElementById('pwOverlay');
  const input = document.getElementById('pwInput');
  const submit = document.getElementById('pwSubmit');
  const clearBtn = document.getElementById('pwClear');
  const errorEl = document.getElementById('pwError');
  const main = document.getElementById('mainContent');

  async function tryUnlock() {
    const v = (input.value || '').trim();
    if (!v) { errorEl.textContent = 'パスワードを入力してください'; input.focus(); return; }
    try {
      const derived = await deriveKeyPBKDF2(v, STORED.saltBase64, STORED.iterations);
      const stored = fromBase64ToUint8(STORED.derivedKeyBase64);
      if (constTimeEqual(derived, stored)) {
        unlock();
      } else {
        errorEl.textContent = 'パスワードが違います';
        input.value = '';
        input.focus();
      }
    } catch (e) {
      console.error(e);
      errorEl.textContent = '検証中にエラーが発生しました';
    }
  }

  function unlock() {
    overlay.style.transition = 'opacity 200ms ease';
    overlay.style.opacity = '0';
    setTimeout(() => { overlay.remove(); }, 250);
    document.body.classList.remove('locked');
    main.removeAttribute('aria-hidden');
    const firstBtn = document.querySelector('.actions .btn');
    if (firstBtn) firstBtn.focus();
  }

  input.addEventListener('keydown', (e) => { if (e.key === 'Enter') tryUnlock(); });
  submit.addEventListener('click', tryUnlock);
  clearBtn.addEventListener('click', () => { input.value=''; errorEl.textContent=''; input.focus(); });

  window.addEventListener('load', () => { input.focus(); });

  // テスト用ヘルパー（デバッグ目的。実運用では不要）
  window._pw_debug = {
    saltBase64: STORED.saltBase64,
    derivedKeyBase64: STORED.derivedKeyBase64,
    iterations: STORED.iterations
  };
})();
</script>
</body>
</html>
